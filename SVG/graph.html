<button id="animateGraph">Trigger Animation</button>
<button id="regeneratePoints">Regenerate Points</button>
<svg height="700" width="1600" xmlns="http://www.w3.org/2000/svg">


    <rect height="700" width="1600" fill="#747f6c"></rect>
    <!--<path d="M50 600 L 70 60-->
                       <!--90 450-->
                       <!--110 400-->
                       <!--130 420-->
                       <!--150 380-->
                       <!--170 300-->
                       <!--190 480-->
                       <!--210 330-->
                       <!--230 360-->
                       <!--250 250-->
                       <!--270 270-->
                       <!--290 270-->
                       <!--310 150" fill="transparent" stroke="blue" stroke-width="3"/>-->

    <!--<path d="M430 400 C 440 330, 445 300, 450 300-->
                        <!--460 300, 465 340, 470 340-->
                        <!--480 340, 485 340, 490 340" stroke="blue" stroke-width="3" fill="transparent"/>-->

    <path id='graph' d="M50 600 C 60 600, 70 60, 80 60
                       90 60, 100 450, 110 450
                       120 450, 130 400, 140 400
                       150 400, 160 420, 170 420
                       180 420, 190 380, 200 380
                       210 380, 220 300, 230 300
                       240 300, 250 480, 260 480
                       270 480, 280 330, 290 330
                       300 330, 310 360, 320 360
                       330 360, 340 250, 350 250
                       360 250, 370 270, 380 270
                       390 270, 400 270, 410 270
                       420 270, 430 150, 440 150
                     L 440 600 Z" stroke="#752796" stroke-width="3" fill="#c94cff">
        <animate attributeName="d" to="M50 600 C 60 600, 70 60, 80 60
                       90 60, 100 450, 110 450
                       120 450, 130 400, 140 400
                       150 400, 160 420, 170 420
                       180 420, 190 380, 200 380
                       210 380, 220 300, 230 300
                       240 300, 250 480, 260 480
                       270 480, 280 330, 290 330
                       300 330, 310 360, 320 360
                       330 360, 340 250, 350 250
                       360 250, 370 270, 380 270
                       390 270, 400 270, 410 270
                       420 270, 430 150, 440 150
                     L 440 600 Z" dur="1000ms" repeatCount="1">

        </animate>
    </path>




    <script>
        var Ys = [];
        Ys[0] = [600, 60,  450, 400, 420, 380, 300, 480, 330, 40,  250, 270, 100, 450];
        Ys[1] = [600, 250, 450, 400, 420, 380, 300, 200, 330, 360, 250, 270, 400, 300];
        Ys[2] = [600, 520, 300, 220, 500, 450, 250, 250, 230, 220, 200, 500, 100, 50];
        var inputs = 3, selectedInput = 0;

        document.getElementById('animateGraph').onclick = () => {animateGraph(Ys[(selectedInput++)%inputs])};
        document.getElementById('regeneratePoints').onclick = () => {swapPoints(document.getElementById('graph'), generatePathPoints(Ys))};

        document.querySelector('#graph animate').addEventListener('mySpecialEvent',function(){
          this.style.fill = 'green';
          console.log('pula');
        },false);
        document.querySelector('#graph animate').addEventListener('oanimationend animationend webkitAnimationEnd', function() {
          console.log('Animation finished');
        }, false);
        console.log(document.querySelector('#graph animate'));

        function animateGraph(points){
          var graph = document.getElementById('graph');
          var graphAnimation = graph.getElementsByTagName('animate')[0];
          graphAnimation.setAttribute('to', 'M50 600 C' + generatePathPoints(points) + 'L 440 600 Z');
          graphAnimation.beginElement();

          setTimeout(function () {
            graph.setAttribute('d', 'M50 600 C' + generatePathPoints(points) + 'L 440 600 Z');
          }, 1000);
        }


        function generatePathPoints(Ys){
          var points = generatePointsFromYs(Ys);
          var bezierPoints = calculateBezierPoints(points);
          console.log(bezierPoints);
          points.pop();
          var graphPoints = createGraphPoints(points, bezierPoints);

          graphPoints = graphPoints.map(point => stringifyPoint(point) + ', ');
          var allPointsString = ''
          graphPoints.forEach(pointString => allPointsString += pointString);
          return allPointsString;

          function generatePointsFromYs(ys){
            var points = [];
            var x=30;
            ys.forEach(y => {
              points.push({x:x += 30, y:y});
          });

            //console.log(points);
            return points
          }

          function calculateBezierPointsBetweenInterval(p1, p2){
            var bez1 = {x: p1.x + 10, y:p2.y};//somehow it works better if both points have p2.y
            var bez2 = {x: p1.x + 20, y:p2.y};

            return [bez1, bez2];
          }

          function calculateBezierPoints(graphPoints){
            var bezierPairs = [];
            for(let i=0; i <= graphPoints.length - 2; i++){
              let bPoints = calculateBezierPointsBetweenInterval(graphPoints[i], graphPoints[i+1]);
              bezierPairs.push(bPoints[0]);
              bezierPairs.push(bPoints[1]);
            }
            //console.log(bezierPairs);
            return bezierPairs;
          }

          function createGraphPoints(points, bezierPoints){
            var graphPoints = [];
            var bezIndex = 0;
            points.forEach(point => {
              graphPoints.push(point);
            graphPoints.push(bezierPoints[bezIndex]);
            bezIndex++;
            graphPoints.push(bezierPoints[bezIndex]);
            bezIndex++;
          });

            //console.log(graphPoints);
            return graphPoints;
          }

          function stringifyPoint(point){
            return "" + point.x + " " + point.y;
          }
        }
    </script>

</svg>