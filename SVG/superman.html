<!--suppress ALL -->

<svg version="1.1" baseProfile="full"
     xmlns="http://www.w3.org/2000/svg"
     id="canvas" viewBox="0 0 800 600"
     stroke="black" stroke-width="0.5px"
     onmousemove="mouseMove(evt)"
     onmouseout="revert(evt)">

    <defs>
        <rect id="def-rect"
              x="-25" y="-25"
              width="50" height="50"
              fill="#29e">
        </rect>
    </defs>

    <!-- reference resourses by ID in xlink:href attribute -->
    <use xlink:href="#def-rect" transform="translate(100 50)">
        <!--<animate attributeName="transform" to="translate(300 150)" dur="500ms" repeatCount="indefinite"></animate>-->
        <animateTransform
                attributeName="transform" type="translate"
                values="0 0; 200 50; 0 0"
                additive="sum"
                dur="3s"
                repeatCount="indefinite" />
        <animateTransform
                attributeName="transform" type="rotate"
                values="360 0 0; 0 0 360; 360 0 0"
                additive="sum"
                dur="3s"
                repeatCount="indefinite" />
        <animateTransform
                attributeName="transform" type="scale"
                values="0.5; 1.5; 0.5"
                additive="sum"
                dur="3s"
                repeatCount="indefinite" />
    </use>
    <use xlink:href="#def-rect" transform="translate(200 50)"/>
    <use xlink:href="#def-rect" transform="translate(300 50)"/>


    <symbol id="pointed-bezier-curve-item">
        <path d="M10 80 C 40 10, 65 10, 95 80 S 150 150, 180 80, 250 10, 275 80" stroke="black" fill="transparent"/>
        <circle cx="10" cy="80" r="2" fill="red"></circle>
        <circle cx="40" cy="10" r="2" fill="red"></circle>
        <circle cx="65" cy="10" r="2" fill="red"></circle>
        <circle cx="95" cy="80" r="2" fill="red"></circle>

        <circle cx="150" cy="150" r="2" fill="red"></circle>
        <circle cx="180" cy="80" r="2" fill="red"></circle>
        <circle cx="250" cy="10" r="2" fill="red"></circle>
        <circle cx="275" cy="80" r="2" fill="red"></circle>
    </symbol>

    <symbol id="cloud-item">
        <path d="M10 80 C 40 10, 65 10, 95 80 S 150 150, 180 80" stroke="black" fill="transparent"/>
        <circle cx="10" cy="80" r="2" fill="red"></circle>
        <circle cx="40" cy="10" r="2" fill="red"></circle>
        <circle cx="65" cy="10" r="2" fill="red"></circle>
        <circle cx="95" cy="80" r="2" fill="red"></circle>

        <circle cx="150" cy="150" r="2" fill="red"></circle>
        <circle cx="180" cy="80" r="2" fill="red"></circle>
    </symbol>

    <use href="#pointed-bezier-curve-item" transform="translate(300 100)"></use>

    <symbol id="background-first-half" width="800" height="600">
        <polygon id="mountain1" points="0,600 100,210 200,600" fill="gray" stroke="lime" stroke-width="1" >
            <animate attributeName="points" from="0,600 100,210 200,600" to="-200,600 -100,250 0,600"
            dur="4" repeatCount="indefinite"></animate>
        </polygon>

        <polygon id="mountain2" points="100,600 200,300 300,600" fill="gray" stroke="lime" stroke-width="1" >
            <animate attributeName="points" from="100,600 200,300 300,600" to="-200,600 -100,340 0,600"
                     dur="4" repeatCount="indefinite"></animate>
        </polygon>

        <polygon id="mountain3" points="300,600 400,150 500,600" fill="gray" stroke="lime" stroke-width="1" >
            <animate attributeName="points" from="300,600 400,150 500,600" to="-200,600 -100,190 0,600"
                     dur="4" repeatCount="indefinite"></animate>
        </polygon>
    </symbol>

    <symbol id="background-second-half" width="800" height="600">
        <polygon points="800,600 900,210 1000,600" fill="gray" stroke="lime" stroke-width="1" >
            <animate attributeName="points" from="800,600 900,210 1000,600" to="0,600 100,210 200,600"
                     dur="4" repeatCount="indefinite"></animate>
        </polygon>

        <polygon points="900,600 1000,300 1100,600" fill="gray" stroke="lime" stroke-width="1" >
            <animate attributeName="points" from="900,600 1000,300 1100,600" to="100,600 200,300 300,600"
                     dur="4" repeatCount="indefinite"></animate>
        </polygon>

        <polygon points="1100,600 1200,150 1300,600" fill="gray" stroke="lime" stroke-width="1" >
            <animate attributeName="points" from="1100,600 1200,150 1300,600" to="300,600 400,150 500,600"
                     dur="4" repeatCount="indefinite"></animate>
        </polygon>

    </symbol>

    <use id="background1" href="#background-first-half"></use>
    <use href="#background-second-half"></use>

    <!--<svg width="120" height="140">-->
        <!--&lt;!&ndash; symbol definition  NEVER draw &ndash;&gt;-->
        <!--<symbol id="sym01" viewBox="0 0 150 110">-->
            <!--  <circle cx="50" cy="50" r="40" stroke-width="8"-->
                      <!--stroke="red" fill="red"/>-->
            <!--  <circle cx="90" cy="60" r="40" stroke-width="8"-->
                      <!--stroke="green" fill="white"/>-->
        <!--</symbol>-->

        <!--&lt;!&ndash; actual drawing by "use" element &ndash;&gt;-->
        <!--<use href="#sym01"-->
             <!--     x="0" y="0" width="100" height="50"/>-->
        <!--<use href="#sym01"-->
             <!--     x="0" y="50" width="75" height="38"/>-->
        <!--<use href="#sym01"-->
             <!--     x="0" y="100" width="50" height="25"/>-->
    <!--</svg>-->

    <text id="posX" x="20" y="15" fill="red">X: -- px </text>
    <text id="posY" x="20" y="40" fill="red">Y: -- px </text>


    <image id="superman" href="superman.png" x="100" y="300" width="300" height="200" fill="black">
        <animate id="animate-up" attributeName="y" from="20" to="0"
                 begin="click" dur="500ms" repeatCount="1"></animate>
    </image>
    <polygon id="laser1" points="0,0 160,210" style="stroke:rgb(255,0,0);stroke-width:2" />
    <polygon id="laser2" points="0,0 160,210" style="stroke:rgb(255,0,0);stroke-width:2" />


    <script>
      var canvas = document.getElementById('canvas');
      var up=true;
      setInterval(() => {
        // document.getElementById('laser1').setAttribute('points', up?'271,340 ':'271,320 ' + dx + ',' + dy );
        // document.getElementById('laser2').setAttribute('y', up?300:320);


        var graphAnimation = document.getElementById('superman').getElementsByTagName('animate')[0];
        graphAnimation.setAttribute('to', up?300:320);
        graphAnimation.setAttribute('from', up?320:300);
        graphAnimation.beginElement();

        console.log(up + ' ' + document.getElementById('superman').getAttribute('y'));
        up = !up;
      },500);

      function mouseMove(evt){
        let mousePosition = cursorPoint(evt);

        document.getElementById('posX').textContent = 'X: ' + mousePosition.x + 'px ';
        document.getElementById('posY').textContent = 'Y: ' + mousePosition.y + 'px';

        document.getElementById('laser1').setAttribute( 'points','271,340 ' + mousePosition.x + ',' + mousePosition.y );
        document.getElementById('laser2').setAttribute( 'points','271,345 ' + mousePosition.x + ',' + mousePosition.y );

      }
      var pt = canvas.createSVGPoint();
      function cursorPoint(evt){
        pt.x = evt.clientX; pt.y = evt.clientY;
        return pt.matrixTransform(canvas.getScreenCTM().inverse());
      }

      function revert(evt){
        document.getElementById('posX').textContent = 'X: -- px';
        document.getElementById('posY').textContent = 'Y: -- px';

        // var mountain;
        // for (var i = 1; i <= 3; i++){
        //   mountain = document.getElementById('background1').getElementById("mountain" + i);
        //   mountain.setAttributeNS(null, "fill", "gray");
        //
        //   mountain = document.getElementById("mountain" + i + i);
        //   mountain.setAttributeNS(null, "fill", "gray");
        // }
      }
    </script>

</svg>